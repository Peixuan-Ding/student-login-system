# æ•°æ®åº“è¯´æ˜

## ğŸ“ æ•°æ®åº“ç»“æ„

æœ¬é¡¹ç›®ä½¿ç”¨ JSON æ–‡ä»¶ä½œä¸ºæ•°æ®åº“ï¼Œå­˜å‚¨åœ¨ `database/` ç›®å½•ä¸‹ï¼Œç”± `utils/database.js` è´Ÿè´£è¯»å†™ã€‚

å½“å‰æœ‰æ•ˆæ•°æ®æ–‡ä»¶ï¼š
- `users.json`ï¼ˆç”¨æˆ·ä¸ç»Ÿè®¡å…ƒæ•°æ®ï¼‰
- `courses.json`ï¼ˆè¯¾ç¨‹ä¸æ•™å­¦å‘¨ç­‰ï¼‰
- `materials.json`ï¼ˆæ•™æ/èµ„æ–™ï¼Œæ–‡ä»¶ä¸Šä¼ ä¿å­˜ï¼‰
- `lesson-plans.json`ï¼ˆæ•™æ¡ˆï¼Œæ–‡ä»¶ä¸Šä¼ ä¿å­˜ï¼‰
- `resources.json`ï¼ˆä¸ªäººçŸ¥è¯†åº“/èµ„æºï¼Œæ–‡ä»¶ä¸Šä¼ ä¿å­˜ï¼‰
- `tutors.json`ï¼ˆå­¦ç§‘ä¸“ä¸šå¯¼å¸ˆé…ç½®ä¸å†…å®¹ï¼‰

> å·²ç§»é™¤ï¼š`chat-sessions.json`ï¼ˆå†å²ä¼šè¯å­˜å‚¨ä¸å†ä½¿ç”¨ï¼‰

---

### users.json â€” ç”¨æˆ·æ•°æ®
```json
{
  "users": [
    {
      "studentId": "12345678",    // å­¦å·ï¼ˆ8ä½æ•°å­—ï¼‰
      "password": "abcdef",       // å¯†ç ï¼ˆ6ä½å­—æ¯ï¼‰æˆ– bcrypt åŠ å¯†ï¼Œä»¥ $2 å¼€å¤´
      "name": "å¼ ä¸‰",             // å§“å
      "grade": "ä¸‰å¹´çº§",          // å¹´çº§
      "email": "zhangsan@example.com",
      "avatar": "ğŸ‘¨â€ğŸ“",         // å¤´åƒ
      "role": "student",          // è§’è‰²
      "createdAt": "2024-01-01T00:00:00.000Z",
      "lastLogin": "2024-10-27T00:00:00.000Z",
      "isActive": true            // æ˜¯å¦æ¿€æ´»
    }
  ],
  "metadata": {
    "version": "1.0.0",
    "lastUpdated": "2024-10-27T00:00:00.000Z",
    "totalUsers": 5
  }
}
```

### courses.json â€” è¯¾ç¨‹æ•°æ®
ç”¨äºè¯¾ç¨‹/æ•™å­¦å‘¨å†…å®¹ï¼ˆå…·ä½“ç»“æ„æŒ‰ä¸šåŠ¡æ‰©å±•ï¼‰ã€‚

### materials.json â€” æ•™å­¦ææ–™ï¼ˆæ•™æ/èµ„æ–™ï¼‰
æ–‡ä»¶ä¸Šä¼ ä¿å­˜ä½ç½®ã€‚ç¤ºä¾‹ç»“æ„ï¼ˆæ•°ç»„é”®ä¸º `materials`ï¼‰ï¼š
```json
{
  "materials": [
    {
      "id": "mat_001",                // ç”±åç«¯ç”Ÿæˆï¼Œå‰ç¼€ mat_
      "title": "Unit1-Reading.pdf",   // å†—ä½™å‘½åï¼štitle ä¸ name å‡å­˜
      "name": "Unit1-Reading.pdf",
      "filePath": "uploads/tmp/169...pdf", // ç‰©ç†è·¯å¾„ï¼ˆå¦‚æä¾›ï¼‰
      "uploadDate": "2025-10-30T10:00:00.000Z",
      "size": 123456,                   // å¯é€‰
      "mimeType": "application/pdf"    // å¯é€‰
    }
  ]
}
```

### lesson-plans.json â€” æ•™æ¡ˆ
æ–‡ä»¶ä¸Šä¼ ä¿å­˜ä½ç½®ã€‚ç¤ºä¾‹ç»“æ„ï¼ˆæ•°ç»„é”®ä¸º `lessonPlans`ï¼‰ï¼š
```json
{
  "lessonPlans": [
    {
      "id": "lp_001",                 // å‰ç¼€ lp_
      "title": "ä¸ƒä¸Š-Unit3-æ•™æ¡ˆ",
      "name": "ä¸ƒä¸Š-Unit3-æ•™æ¡ˆ.docx",
      "filePath": "uploads/tmp/169...docx",
      "uploadDate": "2025-10-30T10:00:00.000Z"
    }
  ]
}
```

### resources.json â€” ä¸ªäººçŸ¥è¯†åº“/èµ„æº
æ–‡ä»¶ä¸Šä¼ ä¿å­˜ä½ç½®ã€‚ç¤ºä¾‹ç»“æ„ï¼ˆæ•°ç»„é”®ä¸º `resources`ï¼‰ï¼š
```json
{
  "resources": [
    {
      "id": "res_001",                 // å‰ç¼€ res_
      "title": "è‹±è¯­å•è¯è¡¨",
      "name": "words.txt",
      "filePath": "uploads/tmp/169...txt",
      "uploadDate": "2025-10-30T10:00:00.000Z"
    }
  ]
}
```

### tutors.json â€” å­¦ç§‘ä¸“ä¸šå¯¼å¸ˆ
è·¯ç”± `routes/tutors.js` ä½¿ç”¨ã€‚ç¤ºä¾‹ç»“æ„ï¼š
```json
{
  "tutors": [
    {
      "id": "tut_1730275930000",
      "name": "è‹±è¯­å­¦ç§‘å¯¼å¸ˆ",
      "subject": "è‹±è¯­",
      "goal": "æå‡é˜…è¯»ç†è§£",
      "note": "åå‘ç²¾è¯»è®­ç»ƒ",
      "fileContext": "ï¼ˆå¯é€‰ï¼‰ä¸ä»»åŠ¡ç›¸å…³çš„èµ„æ–™æ–‡æœ¬",
      "createdAt": "2025-10-30T10:00:00.000Z"
    }
  ]
}
```

---

## ğŸ” é»˜è®¤è´¦æˆ·

é¡¹ç›®é¢„è®¾äº†ä»¥ä¸‹æµ‹è¯•è´¦æˆ·ï¼š

| å­¦å· | å¯†ç  | å§“å | å¹´çº§ | çŠ¶æ€ |
|------|------|------|------|------|
| 12345678 | abcdef | å¼ ä¸‰ | ä¸‰å¹´çº§ | âœ… æ¿€æ´» |
| 20240001 | student | æå›› | å››å¹´çº§ | âœ… æ¿€æ´» |
| 20240002 | test123 | ç‹äº” | äº”å¹´çº§ | âœ… æ¿€æ´» |
| 20240003 | demoab | èµµå…­ | å…­å¹´çº§ | âœ… æ¿€æ´» |
| 20240004 | student | å°çº¢ | ä¸€å¹´çº§ | âœ… æ¿€æ´» |

---

## ğŸ“¡ API æ¥å£è¯´æ˜ï¼ˆä¸æ•°æ®åº“çš„å¯¹åº”å…³ç³»ï¼‰

### ç”¨æˆ·ç›¸å…³æ¥å£

#### ç™»å½•
```http
POST /api/auth/login
Content-Type: application/json

{
  "studentId": "12345678",
  "password": "abcdef"
}
```

å“åº”ï¼š
```json
{
  "success": true,
  "user": {
    "studentId": "12345678",
    "name": "å¼ ä¸‰",
    "grade": "ä¸‰å¹´çº§",
    ...
  }
}
```

#### è·å–ç”¨æˆ·åˆ—è¡¨
```http
GET /api/users
```

#### æ·»åŠ æ–°ç”¨æˆ·
```http
POST /api/users
Content-Type: application/json

{
  "studentId": "20240005",
  "password": "passwd",
  "name": "æ–°ç”¨æˆ·",
  "grade": "äºŒå¹´çº§",
  "email": "newuser@example.com"
}
```

#### æ›´æ–°ç”¨æˆ·ä¿¡æ¯
```http
PUT /api/users/:studentId
Content-Type: application/json

{
  "name": "æ–°åç§°",
  "grade": "æ–°å¹´çº§"
}
```

### å…¶ä»–æ¥å£

- `GET /api/courses` - è·å–è¯¾ç¨‹åˆ—è¡¨
- `GET /api/materials` - è·å–æ•™å­¦ææ–™
- `GET /api/lesson-plans` - è·å–æ•™æ¡ˆ
- `GET /api/resources` - è·å–èµ„æº
- `GET /api/tutors` - è·å–å¯¼å¸ˆåˆ—è¡¨
- `POST /api/tutors` - æ–°å¢å¯¼å¸ˆ
- `PUT /api/tutors/:id` - æ›´æ–°å¯¼å¸ˆ
- `DELETE /api/tutors/:id` - åˆ é™¤å¯¼å¸ˆ

### ä¸Šä¼ ä¸æ–‡ä»¶ä¿å­˜æ¥å£ï¼ˆå½±å“ materials/lesson-plans/resourcesï¼‰
- `POST /api/upload` - ä¸Šä¼ æ–‡ä»¶ï¼ˆæ”¯æŒ PDF/Word/TXT/å›¾ç‰‡ç­‰ï¼‰ï¼Œåç«¯ä¼šè§£ææ–‡æœ¬ç”¨äº AI ä¸Šä¸‹æ–‡
- `POST /api/upload/save-file` - å°†ä¸Šä¼ çš„æ–‡ä»¶ä¿¡æ¯å†™å…¥æ•°æ®åº“
  - è¯·æ±‚ä½“ï¼š`{ category: 'textbook'|'materials'|'lessonPlan'|'lesson_plans'|'resource'|'resources', fileData: {...} }`
  - æ•°æ®åº“é”®æ˜ å°„ï¼š
    - textbook|materials â†’ `materials`ï¼ˆå‰ç¼€ `mat_`ï¼‰
    - lessonPlan|lesson_plans â†’ `lessonPlans`ï¼ˆå‰ç¼€ `lp_`ï¼‰
    - resource|resources â†’ `resources`ï¼ˆå‰ç¼€ `res_`ï¼‰
- `DELETE /api/upload/delete-file/:category/:fileId` - ä»æ•°æ®åº“åˆ é™¤è®°å½•ï¼Œå¹¶å°è¯•åˆ é™¤ç‰©ç†æ–‡ä»¶
- `POST /api/upload/upload/cleanup` - æ¸…ç†ä¸´æ—¶ä¸Šä¼ æ–‡ä»¶

---

## ğŸ› ï¸ ä½¿ç”¨æŒ‡å—

### 1. å¯åŠ¨æœåŠ¡å™¨
```bash
npm start
```
æœåŠ¡å™¨å°†è¿è¡Œåœ¨ `http://localhost:3000`

### 2. æµ‹è¯•ç™»å½•
è®¿é—® `http://localhost:3000`
ä½¿ç”¨è´¦æˆ·ï¼š`12345678` / `abcdef`

### 3. ç®¡ç†ç”¨æˆ·
#### æ·»åŠ æ–°ç”¨æˆ·
å¯ä»¥ç›´æ¥ç¼–è¾‘ `database/users.json` æˆ–ä½¿ç”¨ API æ¥å£æ·»åŠ ã€‚

#### ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
```bash
# ç›´æ¥ç¼–è¾‘ users.json æ–‡ä»¶
# æˆ–ä½¿ç”¨ API æ¥å£
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¯†ç å®‰å…¨**: `users.json` åŒ…å«æ˜æ–‡å¯†ç ï¼Œä¸è¦æäº¤åˆ°å…¬å¼€ä»“åº“
2. **æ•°æ®å¤‡ä»½**: å®šæœŸå¤‡ä»½ `database/` ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶
3. **å¹¶å‘æ§åˆ¶**: å½“å‰å®ç°ä¸æ”¯æŒå¹¶å‘å†™å…¥ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹éœ€è¦æ”¹è¿›
4. **æ€§èƒ½è€ƒè™‘**: å¦‚æœç”¨æˆ·é‡å¾ˆå¤§ï¼Œå»ºè®®è¿ç§»åˆ°çœŸå®çš„æ•°æ®åº“ï¼ˆMySQLã€PostgreSQLç­‰ï¼‰

---

## ğŸ”„ æ•°æ®è¿ç§»

### ä»ç¡¬ç¼–ç è¿ç§»åˆ°æ•°æ®åº“
é¡¹ç›®å·²ç»ä» `script.js` ä¸­çš„ç¡¬ç¼–ç ç”¨æˆ·æ•°æ®åº“è¿ç§»åˆ° JSON æ–‡ä»¶æ•°æ®åº“ï¼Œæ‰€æœ‰ç”¨æˆ·æ•°æ®ç°åœ¨å­˜å‚¨åœ¨ `database/users.json`ã€‚

### å¤‡ä»½æ•°æ®
```bash
# å¤‡ä»½æ•´ä¸ªæ•°æ®åº“ç›®å½•
cp -r database database_backup_$(date +%Y%m%d)
```

### æ¢å¤æ•°æ®
```bash
# æ¢å¤å¤‡ä»½
cp -r database_backup_20241027 database
```

---

## ğŸ“ˆ æ‰©å±•å»ºè®®

### å‡çº§åˆ°çœŸå®æ•°æ®åº“

å¦‚æœé¡¹ç›®éœ€è¦æ‰©å±•ï¼Œå»ºè®®å‡çº§åˆ°ä»¥ä¸‹æ–¹æ¡ˆä¹‹ä¸€ï¼š

#### æ–¹æ¡ˆ1: SQLite
```bash
npm install better-sqlite3
```
é€‚åˆè½»é‡çº§åº”ç”¨ï¼Œå•æ–‡ä»¶æ•°æ®åº“ã€‚

#### æ–¹æ¡ˆ2: MongoDB
```bash
npm install mongodb mongoose
```
é€‚åˆæ–‡æ¡£å‹æ•°æ®ï¼Œçµæ´»æ˜“æ‰©å±•ã€‚

#### æ–¹æ¡ˆ3: PostgreSQL/MySQL
```bash
npm install pg mysql2
```
é€‚åˆå¤æ‚æŸ¥è¯¢å’Œé«˜æ€§èƒ½éœ€æ±‚ã€‚

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ï¼šç”¨æˆ·æ— æ³•ç™»å½•
- æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
- æ£€æŸ¥ `database/users.json` æ˜¯å¦å­˜åœ¨
- æ£€æŸ¥ JSON æ ¼å¼æ˜¯å¦æ­£ç¡®

### é—®é¢˜ï¼šæ•°æ®ä¸¢å¤±
- ä»å¤‡ä»½æ¢å¤
- æ£€æŸ¥ `.gitignore` æ˜¯å¦æ’é™¤äº†æ•°æ®åº“æ–‡ä»¶

### é—®é¢˜ï¼šæ–‡ä»¶æƒé™é”™è¯¯
```bash
# Linux/Mac
chmod -R 755 database/

# Windows (PowerShell)
icacls database /grant Users:F
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æœåŠ¡å™¨æ—¥å¿—
2. æµè§ˆå™¨æ§åˆ¶å°
3. æ•°æ®åº“æ–‡ä»¶å®Œæ•´æ€§


